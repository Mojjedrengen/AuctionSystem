syntax = "proto3";

import "google/protobuf/empty.proto";
option go_package = "github.com/Mojjedrengen/AuctionSystem/grpc/auctionsystem";

package auctionsystem;

// NOTE cannot have a void input in gRPC as far as i know
service Auction {
  rpc Bid(amount) returns (ackmsg) {}
  rpc Result(google.protobuf.Empty) returns (resultmsg) {}
}

service ReplicationSync {
  rpc Fetch(self) returns (AuctionData) {}
  rpc Heartbeat(self) returns (google.protobuf.Empty) {}
  rpc RegisterNode(self) returns (google.protobuf.Empty) {}
  rpc GetCluster(self) returns (ClusterInfo);
}

message amount {
  uint64 amount = 1;
  UUID id = 2;
}

message UUID { string value = 1; }

message resultmsg {
  UUID highestbidder = 1;
  state state = 2;
}

message ClusterInfo {
  map<uint64, string> members = 1;
}

enum state {
  ONGOING = 0;
  DONE = 1;
}

message ackmsg {
  ack ack = 1;
  optional string exception = 2;
}

enum ack {
  FAIL = 0;
  SUCCESS = 1;
  EXCEPTION = 2;
}

message self {
  string address = 1;
  uint64 id = 2;
}

message AuctionData {
  UUID highestbidder = 1;
  uint64 highestBid = 2;
  repeated UUID knownBidders = 3;
  uint32 bidTimeFrame = 4;
  uint64 bidStartTime = 5;
  UUID lastWonBidder = 6;
  bool isBitOngoin = 7;
  state state = 8;
}
